<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>rumah14 - Analisis Dasar Kuat dari AS</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22d3ee;
      --accent2: #a78bfa;
      --danger: #ef4444;
      --ok: #10b981;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      padding: 16px;
    }
    .container { max-width: 800px; margin: 0 auto; }
    .back-btn {
      display: inline-block;
      margin-bottom: 16px;
      padding: 8px 16px;
      background: #3b82f6;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
    }
    h1 {
      font-size: 1.4rem;
      margin: 0 0 8px;
      color: var(--accent);
    }
    .sub { color: var(--muted); font-size: 0.9rem; margin-bottom: 16px; }
    .card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: var(--muted);
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      background: #0c1220;
      color: var(--text);
      font-size: 0.95rem;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
    }
    button {
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color: #0b1020;
      font-weight: bold;
      border: none;
      cursor: pointer;
      margin-top: 6px;
    }
    button:active { transform: scale(0.98); }
    .btn-secondary {
      background: #1e293b;
      color: var(--text);
    }
    .status {
      padding: 8px;
      border-radius: 8px;
      margin: 10px 0;
      font-weight: bold;
    }
    .success { background: rgba(16, 185, 129, 0.2); color: var(--ok); }
    .error { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
    .output-section { margin-top: 16px; }
    .section-title {
      font-size: 1.1rem;
      margin: 0 0 12px;
      color: var(--accent);
    }
    .freq-table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
    }
    .freq-table td {
      padding: 6px 8px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.05);
    }
    .freq-table .dasar {
      background: rgba(34, 211, 238, 0.1);
      font-weight: bold;
    }
    .top-list {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .top-item {
      background: rgba(167, 139, 250, 0.2);
      border: 1px solid var(--accent2);
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: bold;
    }
    #market-status {
      color: var(--accent);
      font-weight: bold;
      margin-bottom: 8px;
    }
    @media (max-width: 600px) {
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-btn">‚Üê Beranda</a>
    <h1>rumah14 - Analisis Dasar Kuat dari AS</h1>
    <div class="sub">Input 5 result 4D ‚Üí ekstrak digit AS ‚Üí hitung frekuensi dasar (1‚Äì9) ‚Üí tampilkan top dominan.</div>

    <div class="card">
      <div id="market-status">üìä Pilih market untuk memuat data.</div>
      <label for="marketSelect">Pilih Market</label>
      <select id="marketSelect">
        <option value="">-- Pilih Market --</option>
        <option value="SGP">SGP</option>
        <option value="Sidney">Sidney</option>
        <option value="Hongkong">Hongkong</option>
        <option value="Cambodia">Cambodia</option>
        <option value="China">China</option>
        <option value="Taiwan">Taiwan</option>
        <option value="Japan">Japan</option>
        <option value="Nusa">Nusa</option>
      </select>
    </div>

    <div class="card" id="inputSection" style="display:none;">
      <div class="grid">
        <div><label for="r1">Result 1 (tertua)</label><input id="r1" type="text" maxlength="4" inputmode="numeric"></div>
        <div><label for="r2">Result 2</label><input id="r2" type="text" maxlength="4" inputmode="numeric"></div>
        <div><label for="r3">Result 3</label><input id="r3" type="text" maxlength="4" inputmode="numeric"></div>
        <div><label for="r4">Result 4</label><input id="r4" type="text" maxlength="4" inputmode="numeric"></div>
        <div><label for="r5">Result 5 (terbaru)</label><input id="r5" type="text" maxlength="4" inputmode="numeric"></div>
      </div>
      <button id="btnProses">Analisis Dasar Kuat</button>
      <button class="btn-secondary" id="btnClear">Bersihkan</button>
      <button class="btn-secondary" id="btnSample">Isi Contoh</button>
      <div id="status" class="status" style="display:none;"></div>
    </div>

    <div class="card output-section" id="outputSection" style="display:none;">
      <h2 class="section-title">Hasil Analisis</h2>
      
      <p><strong>Digit AS:</strong> <span id="listAs">-</span></p>
      
      <p><strong>Frekuensi Dasar (1‚Äì9):</strong></p>
      <table class="freq-table" id="freqTable"></table>
      
      <p><strong>Top-4 Dasar Dominan:</strong></p>
      <div class="top-list" id="topList"></div>
      
      <button class="btn-secondary" id="btnSalin">Salin Top-4</button>
      <button id="btnSimpan">Simpan ke Firebase (sabar)</button>
    </div>
  </div>

  <!-- Firebase - DIPERBAIKI -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  
  <script>
    // === TABEL MINI: AS ‚Üí 6 DASAR KUAT (1‚Äì9) ===
    const TABEL_DASAR_KUAT = {
      0: [1,2,5,6,7,8],
      1: [9,2,3,4,5,6],
      2: [1,3,4,7,8,9],
      3: [2,4,5,6,8,9],
      4: [1,3,5,6,7,9],
      5: [1,2,4,6,7,8],
      6: [2,3,5,7,8,9],
      7: [1,3,4,5,8,9],
      8: [1,2,4,5,6,9],
      9: [1,2,3,6,7,8]
    };

    // === INISIALISASI FIREBASE (PROYEK 'sabar') ===
    const firebaseConfig = {
      apiKey: "GANTI_DENGAN_API_KEY_ANDA",
      authDomain: "sabar.firebaseapp.com",
      databaseURL: "https://sabar-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "sabar",
      storageBucket: "sabar.appspot.com",
      messagingSenderId: "123456789012",
      appId: "1:123456789012:web:abcdefghijklmnopqrstuvwxyz"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();

    // === ELEMEN DOM ===
    const marketSelect = document.getElementById('marketSelect');
    const inputSection = document.getElementById('inputSection');
    const outputSection = document.getElementById('outputSection');
    const statusEl = document.getElementById('status');
    const marketStatus = document.getElementById('market-status');
    
    const inputs = ['r1','r2','r3','r4','r5'].map(id => document.getElementById(id));
    const listAsEl = document.getElementById('listAs');
    const freqTableEl = document.getElementById('freqTable');
    const topListEl = document.getElementById('topList');

    // === FUNGSI UTAMA ===
    function analisisDasarKuatDariAS(results) {
      const asList = results.map(r => parseInt(r[0], 10));
      const semuaDasar = [];
      
      for (const as of asList) {
        const dasar = TABEL_DASAR_KUAT[as] || [];
        semuaDasar.push(...dasar);
      }
      
      const frekuensi = {};
      for (let d = 1; d <= 9; d++) {
        frekuensi[d] = 0;
      }
      for (const d of semuaDasar) {
        if (d >= 1 && d <= 9) {
          frekuensi[d]++;
        }
      }
      
      const sorted = Object.entries(frekuensi)
        .sort((a, b) => b[1] - a[1])
        .map(([digit]) => parseInt(digit));
      
      const top4 = sorted.slice(0, 4);
      
      return { asList, frekuensi, topDasar: top4, semuaDasar };
    }

    function showStatus(msg, isSuccess = true) {
      statusEl.textContent = msg;
      statusEl.className = `status ${isSuccess ? 'success' : 'error'}`;
      statusEl.style.display = 'block';
    }

    // === SIMPAN & MUAT DATA ===
    function simpanKeLocalStorage(market, data) {
      localStorage.setItem(`rumah14_${market}`, JSON.stringify(data));
    }

    function muatDariLocalStorage(market) {
      const data = localStorage.getItem(`rumah14_${market}`);
      return data ? JSON.parse(data) : null;
    }

    async function simpanKeFirebase(market, data) {
      try {
        await database.ref(`rumah14/${market}`).push({
          ...data,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        showStatus("‚úÖ Berhasil disimpan ke Firebase 'sabar'!", true);
      } catch (err) {
        console.error("Firebase save error:", err);
        showStatus("‚ùå Gagal simpan ke Firebase.", false);
      }
    }

    // === EVENT HANDLERS ===
    marketSelect.addEventListener('change', () => {
      const market = marketSelect.value;
      if (!market) {
        inputSection.style.display = 'none';
        outputSection.style.display = 'none';
        marketStatus.textContent = "üìä Pilih market untuk memuat data.";
        return;
      }

      localStorage.setItem('rumah14_marketAktif', market);
      marketStatus.textContent = `üìä Market aktif: ${market}`;

      const saved = muatDariLocalStorage(market);
      if (saved) {
        inputs.forEach((inp, i) => {
          inp.value = saved.results[i] || '';
        });
        if (saved.output) {
          tampilkanOutput(saved.output);
        }
      }

      inputSection.style.display = 'block';
    });

    window.addEventListener('DOMContentLoaded', () => {
      const lastMarket = localStorage.getItem('rumah14_marketAktif');
      if (lastMarket) {
        marketSelect.value = lastMarket;
        marketSelect.dispatchEvent(new Event('change'));
      }
    });

    document.getElementById('btnProses').addEventListener('click', () => {
      const market = marketSelect.value;
      if (!market) return showStatus("‚ö†Ô∏è Pilih market terlebih dahulu.", false);

      const results = inputs.map(inp => inp.value.trim());
      if (results.some(r => !/^\d{4}$/.test(r))) {
        return showStatus("‚ö†Ô∏è Semua input harus 4 digit angka.", false);
      }

      const output = analisisDasarKuatDariAS(results);
      simpanKeLocalStorage(market, { results, output });
      tampilkanOutput(output);
      showStatus("‚úÖ Analisis dasar kuat selesai.", true);
    });

    function tampilkanOutput(output) {
      const { asList, frekuensi, topDasar } = output;

      listAsEl.textContent = asList.join(', ');

      let html = '<tr>';
      for (let d = 1; d <= 9; d++) {
        if (d > 1 && (d - 1) % 3 === 0) html += '</tr><tr>';
        html += `<td class="dasar">${d}</td><td>${frekuensi[d]}</td>`;
      }
      html += '</tr>';
      freqTableEl.innerHTML = html;

      topListEl.innerHTML = topDasar
        .map(d => `<div class="top-item">${d}</div>`)
        .join('');

      outputSection.style.display = 'block';
    }

    document.getElementById('btnSalin').addEventListener('click', () => {
      const saved = muatDariLocalStorage(marketSelect.value);
      if (!saved?.output) return showStatus("‚ÑπÔ∏è Tidak ada data untuk disalin.", false);
      
      const top4 = saved.output.topDasar.join(',');
      navigator.clipboard.writeText(top4).then(() => {
        showStatus("‚úÖ Top-4 dasar tersalin!", true);
      });
    });

    document.getElementById('btnSimpan').addEventListener('click', () => {
      const market = marketSelect.value;
      if (!market) return showStatus("‚ö†Ô∏è Pilih market.", false);
      
      const saved = muatDariLocalStorage(market);
      if (!saved || !saved.output) return showStatus("‚ÑπÔ∏è Tidak ada hasil untuk disimpan.", false);

      simpanKeFirebase(market, saved);
    });

    document.getElementById('btnClear').addEventListener('click', () => {
      inputs.forEach(inp => inp.value = '');
      outputSection.style.display = 'none';
      const market = marketSelect.value;
      if (market) {
        localStorage.removeItem(`rumah14_${market}`);
      }
    });

    document.getElementById('btnSample').addEventListener('click', () => {
      ['4099','0992','2176','7939','3772'].forEach((v,i) => {
        inputs[i].value = v;
      });
    });
  </script>
</body>
</html>